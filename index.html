<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<title>Gate 異常監控</title>
<style>
  body {
    margin: 0;
    font-family: system-ui, -apple-system, BlinkMacSystemFont;
    background: #0b0f14;
    color: #e6e6e6;
  }
  .wrap {
    padding: 28px 36px;
  }
  h1 {
    margin: 0 0 8px 0;
    color: #4ea1ff;
    font-size: 28px;
  }
  .meta {
    color: #9aa4b2;
    margin-bottom: 12px;
  }
  .direction {
    font-size: 18px;
    margin-bottom: 10px;
  }
  .long { color: #22c55e; }
  .short { color: #ef4444; }
  .neutral { color: #facc15; }

  .warn {
    margin: 12px 0 18px;
    padding: 10px 14px;
    background: #3a2f05;
    color: #facc15;
    border-left: 4px solid #facc15;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 8px;
  }
  th, td {
    padding: 10px 8px;
    border-bottom: 1px solid #1f2937;
    text-align: right;
    font-size: 14px;
  }
  th {
    color: #9aa4b2;
    font-weight: 500;
  }
  th:first-child, td:first-child {
    text-align: left;
  }
  td.dir {
    font-weight: 600;
    text-transform: uppercase;
  }
</style>
</head>

<body>
<div class="wrap">
  <h1>Gate 異常監控</h1>
  <div class="meta" id="updated">最後更新：讀取中…</div>
  <div class="direction" id="marketDir">目前方向：判斷中</div>
  <div id="warnBox"></div>

  <table>
    <thead>
      <tr>
        <th>幣種</th>
        <th>方向</th>
        <th>變動</th>
        <th>價格</th>
        <th>強度</th>
      </tr>
    </thead>
    <tbody id="rows"></tbody>
  </table>
</div>

<script>
fetch('./data_fast.json')
  .then(r => r.json())
  .then(data => {
    const items = data.items || [];
    document.getElementById('updated').innerText =
      '最後更新：' + (data.updated || '未知');

    let score = 0;
    let html = '';

    items.forEach(i => {
      // ===== 補算方向 =====
      if (i.change > 1) i.dir = 'long';
      else if (i.change < -1) i.dir = 'short';
      else i.dir = 'neutral';

      // ===== 補算強度（實用版）=====
      i.strength = Math.min(100, Math.round(Math.abs(i.change) * 2));

      // ===== 計分 =====
      if (i.dir === 'long') score += i.strength;
      if (i.dir === 'short') score -= i.strength;

      html += `
        <tr>
          <td>${i.symbol}</td>
          <td class="dir ${i.dir}">${i.dir}</td>
          <td>${i.change.toFixed(2)}%</td>
          <td>$${i.price}</td>
          <td>${i.strength}</td>
        </tr>
      `;
    });

    document.getElementById('rows').innerHTML = html;

    // ===== 整體方向判斷 =====
    let dirText = '';
    let warn = '';

    if (score > 120) {
      dirText = '<span class="long">偏多</span> ｜ 可找多方機會';
    } else if (score < -120) {
      dirText = '<span class="short">偏空</span> ｜ 可找空方機會';
    } else {
      dirText = '<span class="neutral">盤整</span> ｜ 不建議進場';
      warn = `
        <div class="warn">
          ⚠️ 目前方向不明確，僅供觀察，不建議進場
        </div>
      `;
    }

    document.getElementById('marketDir').innerHTML =
      '目前方向：' + dirText + ` ｜ 信心 ${Math.min(100, Math.abs(score))}%`;

    document.getElementById('warnBox').innerHTML = warn;
  })
  .catch(err => {
    document.getElementById('updated').innerText = '資料讀取失敗';
    console.error(err);
  });
</script>
</body>
</html>
